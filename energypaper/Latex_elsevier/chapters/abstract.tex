The optimal design of buildings is a complex task involving energy systems as well as construction measures.
Typically, in exact optimization models, only energy systems are considered, whereas envelope components are neglected.
When considering both, heuristics are commonly used, which do not guarantee optimal or close to optimal results.

Thus, this paper presents the governing equations, validation and exemplary usage of a building model suitable for exact optimization problems.
The developed model simultaneously considers energy systems and building envelopes.
It is based on ISO 13790 and verified according to ASHRAE 140 and further compared to a more detailed model.
The findings show that the developed model largely complies with the ASHRAE requirements and is able to assess buildings' dynamic behavior regarding indoor air temperatures as well as hourly, peak load, and annual heating and cooling loads.

The simultaneous optimization of energy system and envelope is further demonstrated analyzing retrofitting options of a residential building.
We consider solely installing additional PV units, modernizing the building envelope according to German regulations and an optimization without constraints regarding building envelope and energy system.
The results indicate that installing additional PV units can moderately reduce total costs and CO$_2$ emissions.
The envelope modernization according to governmental regulations leads to largely increased costs at lower emissions, whereas the unconstrained optimization is able to simultaneously achieve significant cost and CO$_2$ emission advantages.
